<!DOCTYPE html>
<html>
  <head>
    <title>{{.Title}}</title>
    <meta charset="utf-8">
    <link href="/out.css" rel="stylesheet">
  </head>
  <body>
    <script src="/remark.js"></script>
    <script>
    function ready(fn) {
      if (document.readyState !== 'loading') {
        fn();
      } else {
        document.addEventListener('DOMContentLoaded', fn);
      }
    }

    function initSlides() {
      remark.create({
        sourceUrl: '/slides.md',
        includePresenterNotes: true,
      });
    }

    ready(() => {
      initSlides()

      <!-- START REMOVE -->
      const socket = new WebSocket("/live");

      // Listen for messages
      socket.addEventListener("message", (event) => {
        const data = JSON.parse(event.data)

        if (data.filename === 'out.css') {
          // Refresh CSS
          const links = document.getElementsByTagName("link")
          for (const link of links) {
            if (link.rel === "stylesheet") {
              link.href += "?";
            }
          }
        } else if (data.filename === 'index.html') {
          location.reload()
        } else {
          initSlides()
        }
      });
      <!-- END REMOVE -->
    })
    </script>
  </body>
</html>
