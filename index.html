<!DOCTYPE html>
<html>
  <head>
    <title>{{.Title}}</title>
    <meta charset="utf-8">
    <link href="/out.css" rel="stylesheet">
  </head>
  <body>
    <script src="/remark.js"></script>
    <script>
      var slideshow = remark.create({
        sourceUrl: '/slides.md',
        includePresenterNotes: true,
      });

      const socket = new WebSocket("/live");

      // Connection opened
      // socket.addEventListener("open", (event) => {
      //   console.log('listening for updates')
      // });

      // Listen for messages
      socket.addEventListener("message", (event) => {
        // console.log('received update, reloading', event)
        const data = JSON.parse(event.data)

        if (data.filename === 'out.css') {
          // Refresh CSS
          const links = document.getElementsByTagName("link")
          for (const link of links) {
            if (link.rel === "stylesheet") {
              link.href += "?";
            }
          }
        } else if (data.filename === 'index.html') {
          location.reload()
        } else {
          const oldSlides = Array.from(document.getElementsByClassName("remark-slides-area"))
          var slideshow = remark.create({
            sourceUrl: '/slides.md',
            includePresenterNotes: true,
          });
          for (slides of oldSlides) {
            slides.remove()
          }
        }
      });
    </script>
  </body>
</html>
